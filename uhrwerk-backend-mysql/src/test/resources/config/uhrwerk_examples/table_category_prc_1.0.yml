area: "processing"
vertical: "yelp_db"
table: "table_category_prc"
version: "1.0"
partition_columns:
  - partition_column1
  - partition_column1
variables:
  - table_variable1
  - Table_Variable2

functions:
  - name: my_lookup_class_func
    args:
      first_param: first_param_value
      second_param: second_param_value
    inputs:
      table_a: category_view
      table_b: "dummy_view"
    output: "my_lookup_output_view"

parallelism: 1   # Batches at the same time / 0 & 1 mean single run at a time
max_bulk_size: 1

transform_sql_query: "SELECT * FROM category_view WHERE col1 = '$table_variable1$' AND col2 = '$table_variable2$'"

dependencies:
  - ref: "staging.yelp_db.table_category:1.0"
    format: "parquet"
    view: "category_view"
    partition:
      - column: "partition_column1"
        value: "$dependency_variable1$"
      - column: "partition_column2"
        value: "$dependency_variable2$"

  - ref: "staging.yelp_db.table_category:1.0"
    format: "redshift"
    view: "dummy_view"
    partition:
      - column: "partition_column1"
        value: "$dependency_variable3$"
      - column: "partition_column2"
        value: "$table_variable3$"

targets:
  - connection_name: "local_fs_lake"
    format: "parquet"

  - connection_name: "redshift1"
    format: "redshift"
    table_name: "myschema.dummy_table"